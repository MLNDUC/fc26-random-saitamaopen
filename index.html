<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FC26 Saitama Open</title>

    <!-- PWA -->
    <meta name="theme-color" content="#0b0f16">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="FC26 Random">

    <link rel="manifest" href="manifest.webmanifest">
    <link rel="apple-touch-icon" href="icons/icon-180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icons/icon-512.png">

    <style>
        :root {
            --bg: #0b0f16;
            --panel: #121826;
            --a: #4da3ff;
            --b: #00ffc6;
            --t: #e6ebf2;
            --m: #8a93a6;
        }

        * {
            box-sizing: border-box
        }

        body {
            margin: 0;
            background: radial-gradient(1200px 600px at top, #16203a, var(--bg));
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            color: var(--t)
        }

        h1 {
            text-align: center;
            margin: 16px 0 6px
        }

        .sub {
            text-align: center;
            font-size: 13px;
            color: var(--m);
            margin-bottom: 14px
        }

        .app {
            max-width: 960px;
            margin: 0 auto;
            padding: 12px
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 14px
        }

        @media(min-width:720px) {
            .grid {
                grid-template-columns: 1fr 1fr
            }
        }

        .p {
            background: linear-gradient(180deg, #141c2f, var(--panel));
            border-radius: 16px;
            padding: 14px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, .4)
        }

        .p h2 {
            margin: 0 0 10px;
            font-size: 18px
        }

        .card {
            height: 190px;
            border-radius: 14px;
            background: linear-gradient(145deg, #0f1526, #1a2340);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 10px
        }

        .card.sp {
            animation: pulse .6s infinite alternate;
            filter: blur(.35px)
        }

        @keyframes pulse {
            from {
                box-shadow: 0 0 0 rgba(77, 163, 255, .25)
            }

            to {
                box-shadow: 0 0 36px rgba(77, 163, 255, .6)
            }
        }

        .logo {
            width: 96px;
            height: 96px;
            object-fit: contain
        }

        .name {
            font-weight: 700;
            text-align: center
        }

        .st {
            font-size: 13px;
            color: var(--m);
            min-height: 18px;
            margin-top: 6px
        }

        button {
            margin-top: 10px;
            width: 100%;
            padding: 12px;
            border-radius: 12px;
            border: none;
            font-weight: 700;
            background: linear-gradient(135deg, var(--a), var(--b));
            color: #001019
        }

        button:disabled {
            background: #2a3248;
            color: var(--m)
        }

        .controls {
            margin-top: 14px
        }

        .reset {
            background: linear-gradient(135deg, #ff7a7a, #ffb86b);
            color: #240000
        }

        .remain {
            margin-top: 18px;
            background: #0f1526;
            border-radius: 14px;
            padding: 10px
        }

        .remain h3 {
            margin: 0 0 8px;
            font-size: 14px;
            color: var(--m)
        }

        .list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 8px
        }

        .it {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #141c2f;
            border-radius: 10px;
            padding: 8px;
            font-size: 12px
        }

        .it img {
            width: 30px;
            height: 30px;
            object-fit: contain
        }

        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #1e263d;
            padding: 10px 16px;
            border-radius: 999px;
            opacity: 0;
            transition: .3s;
            z-index: 9999
        }

        .toast.show {
            opacity: 1
        }
    </style>
</head>

<body>
    <h1>üéÆ FC26 ‚Äì Saitama Open</h1>
    <div class="sub">Random Picker</div>

    <div class="app">
        <div class="grid">
            <div class="p">
                <h2>Ng∆∞·ªùi ch∆°i 1</h2>
                <div class="card" id="r0">
                    <img class="logo" id="l0" alt="">
                    <div class="name" id="n0">‚Äî</div>
                </div>
                <div class="st" id="s0"></div>
                <button id="b0">Quay cho Ng∆∞·ªùi ch∆°i 1</button>
            </div>

            <div class="p">
                <h2>Ng∆∞·ªùi ch∆°i 2</h2>
                <div class="card" id="r1">
                    <img class="logo" id="l1" alt="">
                    <div class="name" id="n1">‚Äî</div>
                </div>
                <div class="st" id="s1"></div>
                <button id="b1" disabled>Quay cho Ng∆∞·ªùi ch∆°i 2</button>
            </div>
        </div>

        <div class="controls">
            <button class="reset" id="reset">Reset / Quay l·∫°i t·ª´ ƒë·∫ßu</button>
        </div>

        <div class="remain">
            <h3>ƒê·ªôi c√≤n l·∫°i</h3>
            <div class="list" id="list"></div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        /**
         * ‚úÖ LOCAL LOGOS (PNG 512x512)
         * ƒê·∫∑t file trong /logos/ theo ƒë√∫ng t√™n d∆∞·ªõi.
         */
        const TEAMS = [
            { id: 1, name: "Real Madrid", i: "RM", u: "logos/real-madrid.png" },
            { id: 2, name: "FC Barcelona", i: "BAR", u: "logos/barcelona.png" },
            { id: 3, name: "Paris Saint-Germain", i: "PSG", u: "logos/psg.png" },
            { id: 4, name: "Liverpool", i: "LIV", u: "logos/liverpool.png" },
            { id: 5, name: "Manchester City", i: "MCI", u: "logos/man-city.png" },
            { id: 6, name: "Arsenal", i: "ARS", u: "logos/arsenal.png" },
            { id: 7, name: "Bayern Munich", i: "BAY", u: "logos/bayern.png" },
            { id: 8, name: "Atl√©tico Madrid", i: "ATM", u: "logos/atletico.png" },
            { id: 9, name: "Newcastle United", i: "NEW", u: "logos/newcastle.png" },
            { id: 10, name: "Napoli", i: "NAP", u: "logos/napoli.png" },
            { id: 11, name: "Tottenham Hotspur", i: "TOT", u: "logos/tottenham.png" },
            { id: 12, name: "Chelsea", i: "CHE", u: "logos/chelsea.png" },
            { id: 13, name: "Manchester United", i: "MUN", u: "logos/man-united.png" },
            { id: 14, name: "Bayer Leverkusen", i: "B04", u: "logos/leverkusen.png" },
            { id: 15, name: "Spain", i: "ESP", u: "logos/spain.png" },
            { id: 16, name: "France", i: "FRA", u: "logos/france.png" },
            { id: 17, name: "Argentina", i: "ARG", u: "logos/argentina.png" },
            { id: 18, name: "England", i: "ENG", u: "logos/england.png" },
            { id: 19, name: "Portugal", i: "POR", u: "logos/portugal.png" },
            { id: 20, name: "Germany", i: "GER", u: "logos/germany.png" },
            { id: 21, name: "Inter", i: "INT", u: "logos/inter.png" }
        ];

        // Tick sound (local)
        const tickSound = new Audio("sounds/tick.mp3");
        tickSound.volume = 0.7;
        tickSound.preload = "auto";
        const dongSound = new Audio("sounds/dong.mp3");
        dongSound.volume = 0.8;
        dongSound.preload = "auto";


        let pool = [];
        let picked = [null, null];
        let isSpinning = [false, false];

        const $ = id => document.getElementById(id);

        function toast(msg) {
            const t = $("toast");
            t.textContent = msg;
            t.classList.add("show");
            setTimeout(() => t.classList.remove("show"), 1500);
        }

        function fallback(img, txt) {
            img.src = `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='120' height='120'><rect width='120' height='120' rx='60' fill='%232a3248'/><text x='50%' y='55%' text-anchor='middle' fill='white' font-size='36' font-family='Arial' font-weight='700'>${txt}</text></svg>`;
        }

        function setCard(p, t) {
            const img = $("l" + p);
            img.src = t.u;
            img.loading = "lazy";
            img.decoding = "async";
            img.onerror = () => fallback(img, t.i);
            $("n" + p).textContent = t.name;
        }

        function drawList() {
            $("list").innerHTML = "";
            pool.forEach(t => {
                const d = document.createElement("div");
                d.className = "it";
                const i = document.createElement("img");
                i.src = t.u;
                i.loading = "lazy";
                i.decoding = "async";
                i.onerror = () => fallback(i, t.i);
                d.append(i, document.createTextNode(t.name));
                $("list").appendChild(d);
            });
        }

        function rand() {
            return pool[(Math.random() * pool.length) | 0];
        }

        function playTick() {
            try {
                tickSound.currentTime = 0;
                tickSound.play();
            } catch (e) { }
        }

        /**
         * ‚úÖ G·∫Øt h∆°n + ch·∫≠m h∆°n ·ªü cu·ªëi + th√™m delay h·ªìi h·ªôp
         */
        function spinStart(player) {
            if (isSpinning[player]) return;
            if (player === 1 && !picked[0]) return toast("Quay Ng∆∞·ªùi ch∆°i 1 tr∆∞·ªõc");

            isSpinning[player] = true;


            const card = $("r" + player);
            const status = $("s" + player);

            card.classList.add("sp");
            status.textContent = "ƒêang quay...";

            // iOS: unlock audio on user gesture
            tickSound.play().then(() => tickSound.pause()).catch(() => { });

            const totalTime = 3300;
            const startDelay = 45;
            const endDelay = 700; // ‚úÖ ch·∫≠m h∆°n ·ªü cu·ªëi
            const suspenseHoldMs = 600; // ‚úÖ delay h·ªìi h·ªôp tr∆∞·ªõc khi ch·ªët

            const startTime = performance.now();
            let lastShown = null;

            function loop(now) {
                const elapsed = now - startTime;
                const p = Math.min(elapsed / totalTime, 1);

                // ‚úÖ ease-out m·∫°nh (g·∫Øt): p^3
                const ease = p * p * p;

                const delay = startDelay + (endDelay - startDelay) * ease;

                lastShown = rand();
                setCard(player, lastShown);
                playTick();

                if (p < 1) {
                    setTimeout(() => requestAnimationFrame(loop), delay);
                } else {
                    // ‚úÖ th√™m "ƒë·ª©ng h√¨nh" h·ªìi h·ªôp (v·∫´n gi·ªØ card + nh·ªãp d·ª´ng)
                    status.textContent = "S·∫Øp ra k·∫øt qu·∫£...";
                    setTimeout(() => finishSpin(player), suspenseHoldMs);
                }
            }

            requestAnimationFrame(loop);
        }

        function finishSpin(player) {
            try {
                dongSound.currentTime = 0;
                dongSound.play();
            } catch (e) { }
            const card = $("r" + player);
            const status = $("s" + player);

            // Pick k·∫øt qu·∫£ th·∫≠t t·ª´ pool
            const team = rand();
            picked[player] = team;
            pool = pool.filter(t => t.id !== team.id);

            setCard(player, team);
            status.textContent = "K·∫øt qu·∫£:";
            card.classList.remove("sp");

            drawList();

            isSpinning[player] = false;

            if (player === 0) {
                $("b1").disabled = false;
            } else {
                $("b0").disabled = true;
                $("b1").disabled = true;
            }
        }

        function reset() {
            pool = [...TEAMS];
            picked = [null, null];
            isSpinning = [false, false];

            ["0", "1"].forEach(i => {
                $("n" + i).textContent = "‚Äî";
                $("l" + i).src = "";
                $("s" + i).textContent = "";
                $("r" + i).classList.remove("sp");
            });

            $("b0").disabled = false;
            $("b1").disabled = true;

            drawList();
        }

        $("b0").onclick = () => spinStart(0);
        $("b1").onclick = () => spinStart(1);
        $("reset").onclick = reset;

        // SW register
        if ("serviceWorker" in navigator) {
            window.addEventListener("load", () => navigator.serviceWorker.register("./sw.js"));
        }

        reset();
    </script>
</body>

</html>